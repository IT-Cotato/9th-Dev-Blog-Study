ì‹¤ë¬´ì—­ëŸ‰ ê³¼ì œ í…ŒìŠ¤íŠ¸ ë¬¸ì œí’€ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

<img src = "https://blog.kakaocdn.net/dn/bfTvBH/btsHudQ7nPK/5r5QtT6UCxmlYkxJ2hXwEk/img.png" originWidth:1780 originHeight:795 style:alignCenter>

ê³¼ì œ í’€ì´ê°€ 2ì‹œê°„ì´ ì£¼ì–´ì¡ŒëŠ”ë°, node.js ë¡œ 14ë¬¸ì œë¥¼ 2ì‹œê°„ì•ˆì— í’€ê¸°ì—ëŠ” ì•„ì§ ì™„ë²½í•˜ê²Œ ì ì‘ì„ ëª»í•œ ê²ƒ ê°™ì•„ì„œ ì•„ì‰¬ì› ë‹¤. ì´ˆë°˜ì— ê°ì¡ëŠ”ë° ì‹œê°„ì´ ì¢€ ê±¸ë ¤ì„œ ë” ë§ì´ ìµìˆ™í•´ ì ¸ì•¼ê² ë‹¤.

## ì¡°ê±´

req, resì— ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ëŠ” ë‚´ìš©ì„ ì „ì†¡í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¬¸ì œí’€ì´ëŠ” ì§„í–‰ë˜ì—ˆë‹¤.

ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì„œ SQLë¬¸ì„ ì¨ë³´ì§€ ëª»í•œë‹¤ëŠ”ê²Œ ì¡°ê¸ˆ ì•„ì‰¬ì› ì§€ë§Œ, json íŒŒì¼ë¡œ ì‹¤ì œ dbì™€ ìœ ì‚¬í•˜ê²Œ ì£¼ì–´ì¡Œë‹¤.

## ë¬¸ì œ 1. íŠ¹ì • ë…„ë„ 1999 ì´í›„ ì¶œíŒëœ ë„ì„œ ëª©ë¡ ì¡°íšŒ

ì¡°íšŒ GET ë©”ì„œë“œ ì‚¬ìš©. ì„±ê³µí•˜ë©´ jsonìœ¼ë¡œ í•´ë‹¹ ì±… ì •ë³´ë¥¼ ì‘ë‹µí•œë‹¤. ì—¬ëŸ¬ê°œì˜ ì±…ì„ ë°°ì—´ì— ë‹´ì•„ì„œ ì „ë‹¬í•œë‹¤.

JS ë¬¸ë²•ìœ¼ë¡œ, ë°°ì—´ì—ì„œ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ê°ì²´ë¥¼ ê±¸ëŸ¬ë‚´ëŠ” ë©”ì„œë“œ `filter()` ì‚¬ìš©í•œë‹¤.

```
app.get("/books/after", (req, res) => {
  const afterBooks = books.filter(
  ///...
  );
  res.status(200).json(afterBooks);
});
```

ì´ë•Œ filter ì¡°ê±´ì„ ì–´ë–»ê²Œ ì£¼ì–´ì•¼ í• ê¹Œ í–ˆëŠ”ë°,

books ë°ì´í„° ì•ˆì˜ pub_dateë¥¼ ë…„ë„ë§Œ ë–¼ì„œ ë¹„êµí•  ìˆ˜ ìˆì—ˆë‹¤. `new Date(books.pub_date).getFullYear()` >= 1999

[Date.prototype.getFullYear() - JavaScript | MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Date/getFullYear)

<br/>
ê·¸ëŸ°ë° DBì—ì„œ ë§ì´ ì‚¬ìš©í•˜ëŠ” YYYY-MM-DD í˜•ì‹ì„ Date ê°ì²´ë¡œ ë§Œë“œëŠ” ë©”ì„œë“œëŠ” ì—†ë‹¤.Â 

`**toISOString()**`ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

```
const date = new Date();
const curDate = date.toISOString().split("T")[0];

app.get("/cur-date", (req, res) => {
  res.status(200).json({ date: curDate });
});
```

Date í˜•ì‹ì˜ ë°˜í™˜ì„ ë¬¸ìì—´ë¡œ ë°˜í™˜í•œë‹¤. toString()ì€ `"Wed Oct 05 2011 16:48:00 GMT+0200 (CEST)"` ì´ëŸ¬í•œ í˜•ì‹ìœ¼ë¡œ ë¬¸ìì—´ ë°˜í™˜ì„ í•˜ê¸° ë•Œë¬¸ì— ì„œë²„ì—ì„œ ì²˜ë¦¬í• ë•Œ ë¶ˆë¦¬í•˜ë‹¤.

[Date.prototype.toISOString() - JavaScript | MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString)

<br/>

## ë¬¸ì œ 2. ì‚¬ìš©ìidì˜ ëŒ€ì¶œ ë„ì„œì˜ ë°˜ë‚© ì˜ˆì •ì¼ì˜ í•©

ë°˜ë‚© ì˜ˆì •ì¼ += (ë„ì„œë³„ ë°˜ë‚©ì˜ˆì •ì¼ - í˜„ì¬ ë‚ ì§œ) -> ëˆ„ì 

ìš”êµ¬ì‚¬í•­ì—ì„œ ìœ íš¨í•˜ì§€ ì•ŠëŠ” userId ê°’ì„ ì²´í¬í•´ì£¼ê³ , ìœ íš¨í•˜ë©´ ë°˜ë‚©ì¼ì„ ê³„ì‚°í•œë‹¤.

<br>

URL ì—ì„œ userIdê°’ì„ req parameterë¡œ ìš”ì²­í•˜ê³ ,

```
const userId = parseInt(req.params.userId);
```

users ë°ì´í„°ì—ì„œ ì¡´ì¬í•˜ëŠ”ì§€ íƒìƒ‰í•œë‹¤.

```
 const userExists = users.some((val) => val.id === userId);
  if (!userExists) {
    res.status(404).json({ error: "user not found" });
    return;
  }
```

<br>

ì´ë•Œ **some ë©”ì„œë“œ**ëŠ” ë°°ì—´ ì•ˆì˜ ì–´ë–¤ ìš”ì†Œë¼ë„ ì£¼ì–´ì§„ íŒë³„ í•¨ìˆ˜ë¥¼ ì ì–´ë„ í•˜ë‚˜ë¼ë„ í†µê³¼í•˜ëŠ”ì§€ ë¶ˆë¦¬ì–¸ ê°’ìœ¼ë¡œ ë°˜í™˜í•´ì£¼ê³ , ì „ì²´íƒìƒ‰ì´ ì•„ë‹Œ -> ì°¸ì„ ë°˜í™˜í•˜ëŠ” ì²«ë²ˆì§¸ ìš”ì†Œë¥¼ ì°¾ìœ¼ë©´ ì¦‰ì‹œ ë°˜ë³µì„ ì¤‘ë‹¨í•˜ê³  ë°˜í™˜í•˜ê¸° ë•Œë¬¸ì—

ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ í™•ì¸ì— ìœ ìš©í•˜ë‹¤ğŸ‘

<br>

ë°˜ë‚© ì˜ˆì •ì¼ ê³„ì‚°í•˜ëŠ” ë¶€ë¶„ì´ Date ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë¹„êµí•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ë‚ ì§œ ë³€í™˜ì—ì„œ ì–´ë ¤ì›€ì„ ê²ªì—ˆë‹¤.

ë¨¼ì € ë°ì´í„° íƒìƒ‰ì€ ë°°ì—´ forEach()ë¡œ ëŒê¸°ë¡œ í–ˆë‹¤.

ë°ì´í„°ì˜ userIdë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ìì˜ ë°ì´í„°ë¥¼ ì°¾ì•˜ë‹¤. ì¼ì¹˜í•  ê²½ìš°ì—ë§Œ ê³„ì‚° ì§„í–‰!

```
book_borrowings.forEach((val) => {
    if (val.user_id === userId) {
      const dueDate = new Date(val.due_date);
      ///...
    }
  });
```

<br>

curDate, dueDate ë³€ìˆ˜ì— ê° Date ì •ë³´ë¥¼ ë‹´ê³ ,

ë°˜ë‚©ì¼ìê°€ í˜„ì¬ ë‚ ì§œë³´ë‹¤ í° ê²½ìš° == ë°˜ë‚©ì¼ì´ ì•„ì§ ì§€ë‚˜ì§€ ì•Šì€ ë„ì„œ ì¸ ê²½ìš°

-> `ë°˜ë‚©ì¼ - í˜„ì¬ ë‚ ì§œ` ê³„ì‚°ì„ ì§„í–‰í•œë‹¤.

<br>

êµ¬ê¸€ì— Javascript ë‚ ì§œ ì°¨ì´Â  `**DATEDIFF**` êµ¬í•˜ëŠ” ë°©ë²•ì´ ë§ì´ ì •ë¦¬ë˜ì–´ ìˆì–´ ì°¸ê³ í•˜ì˜€ë‹¤.

> ê°„ë‹¨í•˜ê²ŒëŠ” ë¹„êµí•˜ê³ ì í•˜ëŠ” ë‚ ì§œë¥¼ millisecond ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œ ë³€í™˜í•´ì„œ ë¹¼ê¸°ë¥¼ ê³„ì‚°í•œë‹¤.
>
> ê³„ì‚°ê°’ì„ í•˜ë£¨ì˜ ë°€ë¦¬ì´ˆ `(1000 \* 3600 \* 24)` ë¡œ ë‚˜ëˆ ì£¼ë©´, ë°€ë¦¬ì´ˆê°€ ì•„ë‹Œ ì¼ ë‹¨ìœ„ì˜ ê°’ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.

ì´ë•Œ abs(), ceil()Â  ë“± ìš”êµ¬ì‚¬í•­ì— ë§ëŠ” í•¨ìˆ˜ë¡œ í˜•ì‹ì„ ì§€ì •í•´ ì¤„ í•„ìš”ê°€ ìˆë‹¤.

<br>

ëˆ„ì ë‚ ì§œ totalDueDaysì— ì´ ë°˜ë‚© ì˜ˆì •ì¼ì„ ê³„ì‚°í•´ì¤€ë‹¤.

```
if (dueDate > currentDate) {
        const daysDiff = Math.abs(
          dueDate.getTime() - currentDate.getTime() / (1000 * 3600 * 24)
        );
        totalDueDays += daysDiff;
      }
```

<br>

## ë¬¸ì œ 3. ì¥ë¥´ë³„ ë„ì„œ ì¡°íšŒ

genreê°€ URL req parameterë¡œ ìš”ì²­ë˜ê³ , ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¥ë¥´ê°€ ë„˜ì–´ì˜¬ ìˆ˜ ë„ ìˆì–´ì„œ ì˜ˆì™¸ì²˜ë¦¬ í•´ì•¼ í•œë‹¤.

ë°°ì—´ë¡œ íƒìƒ‰í•œë‹¤. `filter()` ë¡œ genre ì¼ì¹˜í•˜ëŠ”ì§€ íƒìƒ‰!

```
app.get('/genre/:genre', (req, res) => {
  const genre = req.params.genre;
  const booksByGenre = booksData.filter(book => book.genre === genre);
//...
});
```

<br>

ì˜ˆì™¸ì²˜ë¦¬ -> íƒìƒ‰ì„ í–ˆëŠ”ë° booksByGenre ì— ì•„ë¬´ê²ƒë„ ì—†ì„ë•Œ 404 ì—ëŸ¬ë¥¼ ë„ìš°ê³ 

ê°’ì´ ì¡´ì¬í•œë‹¤ë©´! ìƒíƒœê°’ 200ì„ response í•œë‹¤,

```
  if (booksByGenre.length === 0) {
    res.status(404).json({ "error": "genre not found" });
  } else {
    res.status(200).json(booksByGenre);
  }
```

<br>

## ë¬¸ì œ 4. ëŒ€ì¶œ ë„ì„œ ì¤‘ íŠ¹ì • ì¥ë¥´ ë„ì„œì˜ ìˆ˜

ì•ì„œ ì‚¬ìš©í•œ ëŒ€ì¶œëœ ë„ì„œ, ì¥ë¥´ ì¡°íšŒ ì—ì„œ ê³ ë„í™”í•œë‹¤.

genreëŠ” req.queryì—ì„œ ê°€ì ¸ì˜¤ê³ , ìœ íš¨í•˜ì§€ ì•Šì€ ì¥ë¥´ì¼ ê²½ìš° ì—ëŸ¬ ë°œìƒ

```
app.get("/api/v1/books/genre-count", (req, res) => {
  const genre = req.query.genre;
  if (!genre) {
    return res.status(404).json({ error: "genre not found" });
  }
  ///...
});
```

<br>
Borrowingsì—ì„œ ì¥ë¥´ ë„ì„œ ê°œìˆ˜ë¥¼ í™•ì¸í•´ì•¼í•˜ëŠ”ë°

reduce() ë©”ì„œë“œëŠ” ëˆ„ì ê°’ì„ êµ¬í• ë•Œ ìœ ìš©í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©í•œë‹¤!

<br>

ë¨¼ì €, ëŒ€ì¶œ ë„ì„œì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ë•Œ, ì±… ì •ë³´ì—ì„œ -> ëŒ€ì¶œì •ë³´ì˜ idì™€ ê°™ì€ -> book idë¥¼ í•„í„°ë§í•´ì„œ ê°€ì ¸ì˜¨ë‹¤.

ë§Œì•½ì— ê°€ì ¸ì˜¨ ëŒ€ì¶œ ë„ì„œì˜ ì •ë³´ì™€, ìš”ì²­ëœ íŠ¹ì • ì¥ë¥´ê°€ ì¼ì¹˜íŒŒë©´ ëˆ„ì ê°’ì„ ì¦ê°€ì‹œí‚¨ë‹¤.

```
  const cnt = book_borrowings.reduce((acc, cur) => {
    const book = books.find(book => book.id === cur.book_id);
    if (book && book.genre === genre) {
      return acc + 1;
    }
    return acc;
  }, 0);
```

<br>

## ë¬¸ì œ 5. ì‚¬ìš©ìì˜ ë„ì„œ ëŒ€ì¶œ ì •ë³´ ì¡°íšŒ

userIdë¥¼ req.params.userIdë¡œ ë°›ì•„ì™€ì„œ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ì˜ˆì™¸ì²˜ë¦¬ í•œë‹¤.

```
pp.get("/users/:userId/borrowed-books", (req, res) => {
  const userId = parseInt(req.params.userId);
  const user = users.find((user) => user.id === userId);
  if (!user) {
    res.status(404).json({ error: "user not found" });
    return;
  }
  ///...
});
```

<br>

ì‚¬ìš©ì idì˜ ëŒ€ì¶œì •ë³´ë¥¼ book_borrowingsì—ì„œ ì°¾ê³ ! `filter()`

ê·¸ ëŒ€ì¶œ ì •ë³´ì˜ ë„ì„œ idë¥¼ books ì—ì„œ ì°¾ê³ ! `map()` ê·¸ ê°ì²´ë¥¼ return í•œë‹¤.

```
const borrowedBooks = book_borrowings
    .filter((val) => val.user_id === userId)
    .map((val) => {
      const book = books.find((book) => book.id === val.book_id);
      return book;
    });
```

<br>
userIdëŠ” ì¡´ì¬í•˜ëŠ”ë° ëŒ€ì¶œì •ë³´ê°€ ì—†ëŠ” ê²½ìš°, ìƒíƒœì½”ë“œëŠ” 200ìœ¼ë¡œ ë¹ˆ ë°°ì—´ì„ ë°˜í™˜í•œë‹¤.

```
if (!borrowedBooks.length) {
    res.status(200).json([]);
  } else {
    res.status(200).json(borrowedBooks);
  }
```

## â˜‘ï¸ ë°°ìš´ ì 

**Date() í•¨ìˆ˜ ì‚¬ìš©ë²•**. JS ë‚ ì§œ ê³„ì‚°ì˜ ì‘ë™ë°©ì‹ì— ëŒ€í•´ ì´í•´í•˜ê²Œ ë˜ì—ˆë‹¤.

ì‹¹ë‹¤ ì •ê·œ í‘œí˜„ì‹ìœ¼ë¡œ ë‚˜íƒ€ë‚´ì•¼ í•˜ë‚˜...ğŸ˜¢ í–ˆëŠ”ë° ë‹¤í–‰ì´ì—ˆë‹¤.

ì„¤ëª…í•œ ë©”ì„œë“œ ì´ì™¸ì—ë„, `getFullYear()` `getMonth()` ë“± ë‹¤ì–‘í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ë²• + DateDIFF ë§ˆìŠ¤í„°í•˜ê¸°!

<br>

ë°ì´í„°ë¥¼ ì—°ê²°, ì—°ê²°í•´ì„œ ê°€ì ¸ì˜¤ëŠ” ë²• -> ë§ˆì§€ë§‰ ë¬¸ì œ ë¡œì§ì´ ì´ëŸ¬í•œ í˜•íƒœì˜€ë‹¤.

user.Id -> borrowing.userId -> borrowing.bookId -> book.id -> book ì •ë³´ return

ì‹¤ì œ DBë¥¼ ìƒì„±í•´ì„œ ì´ëŸ¬í•œ ë¡œì§ ë™ì‘í•˜ë„ë¡ ë””ë²¨ë¡­ í•´ë³´ê¸°! ~ìˆ™ì œ~

<br>

ìë°”ìŠ¤í¬ë¦½íŠ¸ì— ë§ì´ ìµìˆ™í•´ ì¡Œë‹¤ê³  ìƒê°í–ˆëŠ”ë°, ìš”êµ¬ì‚¬í•­ì— ë§ê²Œ ì ì ˆí•˜ê²Œ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ë” ê³ ë¯¼í•˜ê²Œ ë˜ì—ˆë‹¤. some, filter, find, forEach, map ë“±ë“±,,, ì–´ë–¨ë•Œ ì‚¬ìš©í•˜ëŠ”ì§€ ë” ë§ì´ë§ì´ ì“°ê³ , í”„ë¡œì íŠ¸ì— ì ìš©í•´ ë³´ë©´ì„œ ì‹¤ë ¥ì„ í‚¤ì›Œë‚˜ê°€ì•¼ê² ë‹¤.
